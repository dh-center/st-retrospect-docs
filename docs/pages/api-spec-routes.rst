API - маршруты
============================================================
Методы для работы с маршрутами (:term:`Route`). **Для использования всех нижеперечисленных методов требуется авторизация.**

Base URL: ``http://learnsql.ru:8000``


Получение списка существующих маршрутов
------------------------------------------------------------

**Метод**

GET

**URL**

``BASE_URL/api/routes/get``

**GET-параметры запроса**

+------------+----------------------+------------+--------------+
| Параметр   | Назначение           | Тип данных | Обязательный |
+============+======================+============+==============+
| count      | количество маршрутов | int        | нет          |
+------------+----------------------+------------+--------------+

По умолчанию (если параметр *count* не указан) возвращаются все маршруты.

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [{
        "id": 6,
        "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
        "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
        "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
        "author": null,
        "route_type_id": 1,
        "duration": 68
      }]
    }


Получение маршрута по его id
------------------------------------------------------------

**Метод**

GET

**URL**

``BASE_URL/api/routes/getById``

**GET-параметры запроса**

+------------+----------------------+------------+--------------+
| Параметр   | Назначение           | Тип данных | Обязательный |
+============+======================+============+==============+
| id         | ID маршрута          | int        | да           |
+------------+----------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "route": {
          "id": 6,
          "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
          "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
          "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
          "author": null,
          "route_type_id": 1,
          "duration": 68,
          "location_instances": [
              {
                  "id": 1144,
                  "name": "Церковь во имя Успения Пресвятой Богородицы, Церковь Спаса на Сенной",
                  "description": "Описание",
                  "image_url": "https://images.st-retrospect.dh-center.ru/eyJidWNrZXQiOiJzdC1yZXRyb3NwZWN0LWltYWdlcyIsImtleSI6ImxvY2F0aW9ucy9sb2NhdGlvbi0yNDktbWFpbjE1ODIxMDU4MTY3MjkuanBlZyJ9",
                  "start_date": "1765",
                  "end_date": "1961",
                  "was_built": null,
                  "was_demolished": false,
                  "location_id": 2189,
                  "persons": [
                      {
                          "id": 779,
                          "first_name": "Андрей",
                          "last_name": "Квасов",
                          "patronymic": "Васильевич",
                          "description": "Описание",
                          "birth_date": "1720",
                          "death_date": "1770",
                          "image_url": "",
                          "tags": [
                              {
                                  "id": 52643,
                                  "name": "Родившиеся в 1720 году"
                              }
                          ],
                          "relation": {
                              "quote": "Описание связи",
                              "relation_type_id": 13
                          }
                      }
                  ],
                  "tags": [
                      {
                          "id": 52643,
                          "name": "Родившиеся в 1720 году"
                      }
                  ],
                  "location_types": [
                      {
                          "id": 9,
                          "name": "религиозное сооружение"
                      }
                  ],
                  "action_tags": [],
                  "position": 0
              }
          ]
      }
    }

В ответе содержится описание маршрута.
У маршрута есть поле *location_instances*, содержащее информацию о карточках локаций, включенных в маршрут. У *location_instance* есть набор связанных с ней персон (*persons*). Персона может характеризоваться набором тегов (*tags*). Также может присутствовать информация о типе локации (*location_types*), типах возможных действий в локации (*action_tags*) и позиции локации в последовательности прохождения маршрута (*position*).


Получение списка маршрутов текущего пользователя
------------------------------------------------------------

**Метод**

GET

**URL**

``BASE_URL/api/routes/getUserRoutes``

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [
        {
            "id": 6,
            "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
            "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
            "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
            "author": null,
            "route_type_id": 1,
            "duration": 68
        }
      ]
    }


Добавление маршрута в список маршрутов текущего пользователя
------------------------------------------------------------

**Метод**

POST

**URL**

``BASE_URL/api/routes/addToUserRoutes``

**POST-параметры запроса**

+------------+----------------------+------------+--------------+
| Параметр   | Назначение           | Тип данных | Обязательный |
+============+======================+============+==============+
| id         | ID маршрута          | int        | да           |
+------------+----------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "detail": "success"
    }


Удаление маршрута из списка маршрутов текущего пользователя
------------------------------------------------------------

**Метод**

POST

**URL**

``BASE_URL/api/routes/removeFromUserRoutes``

**POST-параметры запроса**

+------------+----------------------+------------+--------------+
| Параметр   | Назначение           | Тип данных | Обязательный |
+============+======================+============+==============+
| id         | ID маршрута          | int        | да           |
+------------+----------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "detail": "success"
    }


Поиск маршрутов по тегам и максимальной продолжительности
------------------------------------------------------------

**Метод**

POST

**URL**

``BASE_URL/api/routes/search``

**POST-параметры запроса**

+------------+-------------------------------------------------+------------+--------------+
| Параметр   | Назначение                                      | Тип данных | Обязательный |
+============+=================================================+============+==============+
| duration   | Макс. продолжительность маршрута в минутах      | int        | да           |
+------------+-------------------------------------------------+------------+--------------+
| tag_ids    | Список ID тегов для поиска, разделенных запятой | string     | да           |
+------------+-------------------------------------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [
        {
            "id": 6,
            "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
            "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
            "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
            "author": null,
            "route_type_id": 1,
            "duration": 68
        }
      ]
    }

Метод вернет список маршрутов, теги которых содержат **все** из переданных в *tag_ids*
