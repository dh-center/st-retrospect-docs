API - маршруты
============================================================
Методы для работы с маршрутами (:term:`Route`).

Base URL: ``http://learnsql.ru:8000``


Получение списка существующих маршрутов
------------------------------------------------------------

**Метод**

GET

**URL**

``BASE_URL/api/routes/get``

**GET-параметры запроса**

+--------------+----------------------+------------+--------------+
| Параметр     | Назначение           | Тип данных | Обязательный |
+==============+======================+============+==============+
| count        | количество маршрутов | int        | нет          |
+--------------+----------------------+------------+--------------+
| include_tags | флаг вывода тегов    | int        | нет          |
+--------------+----------------------+------------+--------------+

Для вывода тегов маршрутов в параметр *include_tags* нужно передать значение *1*.
По умолчанию (если параметр *count* не указан) возвращаются все маршруты.

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [{
        "id": 6,
        "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
        "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
        "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
        "author": null,
        "route_type_id": 1,
        "duration": 68,
        "views": 0
      }]
    }

**Если передан параметр include_tags=1**

.. code-block:: json

    {
      "routes": [{
        "id": 6,
        "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
        "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
        "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
        "author": null,
        "route_type_id": 1,
        "duration": 68,
        "views": 0,
        "tags": [
          {
            "id": 52643,
            "name": "Родившиеся в 1720 году"
          }
        ]
      }]
    }


Получение маршрута по его id
------------------------------------------------------------

**Метод**

GET

**URL**

``BASE_URL/api/routes/getById``

**GET-параметры запроса**

+--------------+----------------------+------------+--------------+
| Параметр     | Назначение           | Тип данных | Обязательный |
+==============+======================+============+==============+
| id           | ID маршрута          | int        | да           |
+--------------+----------------------+------------+--------------+
| include_tags | флаг вывода тегов    | int        | нет          |
+--------------+----------------------+------------+--------------+

Для вывода тегов маршрутов в параметр *include_tags* нужно передать значение *1*.

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "route": {
          "id": 6,
          "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
          "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
          "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
          "author": null,
          "route_type_id": 1,
          "duration": 68,
          "views": 0,
          "location_instances": [
              {
                  "id": 1144,
                  "name": "Церковь во имя Успения Пресвятой Богородицы, Церковь Спаса на Сенной",
                  "description": "Описание",
                  "image_url": "https://images.st-retrospect.dh-center.ru/eyJidWNrZXQiOiJzdC1yZXRyb3NwZWN0LWltYWdlcyIsImtleSI6ImxvY2F0aW9ucy9sb2NhdGlvbi0yNDktbWFpbjE1ODIxMDU4MTY3MjkuanBlZyJ9",
                  "start_date": "1765",
                  "end_date": "1961",
                  "was_built": null,
                  "was_demolished": false,
                  "location_id": 2189,
                  "location_types": [
                      {
                          "id": 9,
                          "name": "религиозное сооружение"
                      }
                  ],
                  "action_tags": [],
                  "position": 0,
                  "coordinates": {
                    "lat": 59.9300046,
                    "lon": 30.3153241
                  }
              }
          ]
      }
    }

В ответе содержится описание маршрута.
У маршрута есть поле *location_instances*, содержащее информацию о карточках локаций, включенных в маршрут. У *location_instance* есть набор связанных с ней персон (*persons*). Персона может характеризоваться набором тегов (*tags*). Также может присутствовать информация о типе локации (*location_types*), типах возможных действий в локации (*action_tags*) и позиции локации в последовательности прохождения маршрута (*position*).


Получение списка маршрутов текущего пользователя
------------------------------------------------------------

**Требуется авторизация.**

**Метод**

GET

**URL**

``BASE_URL/api/routes/getUserRoutes``

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [
        {
            "id": 6,
            "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
            "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
            "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
            "author": null,
            "route_type_id": 1,
            "duration": 68,
            "views": 0
        }
      ]
    }


Добавление маршрута в список маршрутов текущего пользователя
------------------------------------------------------------

**Требуется авторизация.**

**Метод**

POST

**URL**

``BASE_URL/api/routes/addToUserRoutes``

**POST-параметры запроса**

+------------+----------------------+------------+--------------+
| Параметр   | Назначение           | Тип данных | Обязательный |
+============+======================+============+==============+
| id         | ID маршрута          | int        | да           |
+------------+----------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "detail": "success"
    }


Удаление маршрута из списка маршрутов текущего пользователя
------------------------------------------------------------

**Требуется авторизация.**

**Метод**

POST

**URL**

``BASE_URL/api/routes/removeFromUserRoutes``

**POST-параметры запроса**

+------------+----------------------+------------+--------------+
| Параметр   | Назначение           | Тип данных | Обязательный |
+============+======================+============+==============+
| id         | ID маршрута          | int        | да           |
+------------+----------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "detail": "success"
    }


Поиск маршрутов по id тегов и максимальной продолжительности
------------------------------------------------------------

**Метод**

POST

**URL**

``BASE_URL/api/routes/searchByTagIds``

**POST-параметры запроса**

+------------+-------------------------------------------------+------------+--------------+
| Параметр   | Назначение                                      | Тип данных | Обязательный |
+============+=================================================+============+==============+
| tag_ids    | Список ID тегов для поиска, разделенных запятой | string     | да           |
+------------+-------------------------------------------------+------------+--------------+
| duration   | Макс. продолжительность маршрута в минутах      | int        | нет          |
+------------+-------------------------------------------------+------------+--------------+

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [
        {
            "id": 6,
            "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
            "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
            "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
            "author": null,
            "route_type_id": 1,
            "duration": 68,
            "views": 0
        }
      ]
    }

Метод вернет список маршрутов, теги которых содержат **все** из переданных в *tag_ids*


Поиск маршрутов по словам в названии, описании и тегах
------------------------------------------------------------

**Метод**

POST

**URL**

``BASE_URL/api/routes/searchByQuery``

**POST-параметры запроса**

+---------------+-----------------------------------------------------+------------+--------------+
| Параметр      | Назначение                                          | Тип данных | Обязательный |
+===============+=====================================================+============+==============+
| query         | Список слов, разделенных пробелом                   | string     | да           |
+---------------+-----------------------------------------------------+------------+--------------+
| duration      | Макс. продолжительность маршрута в минутах          | int        | нет          |
+---------------+-----------------------------------------------------+------------+--------------+
| strict_search | Флаг строгого поиска (включение всех слов из query) | int        | нет          |
+---------------+-----------------------------------------------------+------------+--------------+
| stem          | Флаг поиска по основам слов из query                | int        | нет          |
+---------------+-----------------------------------------------------+------------+--------------+

Поиск осуществляется по полям *Route.name*, *Route.description*, *Route.tags.name*.

Для того, чтоб задействовать флаги *strict_search* или *stem*, в них нужно передать значение **1**

При активном *strict_search* поиск слов из *query* в названии, описании и тегах маршрута будет производиться с логической операцией И (включение всех слов). При неактивном - ИЛИ (хотя бы одно слово). При активном *stem* все слова из *query* будут преобразованы к их лингвистическим основам ("университеты" -> "университет").

Пример POST-параметров:

.. code-block:: json

    duration=180
    query=утраченные храмы
    strict_search=1
    stem=1

**Ответ**

Status: 200 OK

.. code-block:: json

    {
      "routes": [
        {
            "id": 6,
            "name": "Маршрут для отчета \"Утраченный Петербург\" с выходом из ИТМО",
            "description": "Этот маршрут познакомит Вас с утраченными храмами Петербурга. \nПротяженность: 5,3 км",
            "image_url": "http://pics.livejournal.com/noir_diamant/pic/0002achx/s640x480",
            "author": null,
            "route_type_id": 1,
            "duration": 68
            "views": 0
        }
      ]
    }


Увеличение счетчика просмотров у маршрута
------------------------------------------------------------

Увеличение значения поля views у маршрута.

**Метод**

POST

**URL**

``BASE_URL/api/routes/addView``

**POST-параметры запроса**

+---------------+-----------------------------------------------------+------------+--------------+
| Параметр      | Назначение                                          | Тип данных | Обязательный |
+===============+=====================================================+============+==============+
| id            | Идентификатор маршрута                              | int        | да           |
+---------------+-----------------------------------------------------+------------+--------------+
| count         | Количество просмотров для добавления (1 или 3)      | int        | нет          |
+---------------+-----------------------------------------------------+------------+--------------+

**Ответ**

Status: 200 OK
